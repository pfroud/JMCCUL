# JMCCUL

JMCCUL is a Java wrapper for [Measurement Computing Corporation Universal Library](https://www.mccdaq.com/daq-software/universal-library.aspx).

Universal Library is software for PC-based data acquisition devices. JMCCUL is a [JNA](https://github.com/java-native-access/jna) wrapper around the C API for Universal Library.

JMCCUL is not endorsed by, authorized by, sponsored by, maintained by, partnered with, affiliated with, or in any way officially connected with Measurement Computing Corporation.

To learn about other ways to use Universal Library, go to [existing-UL-APIs-and-libraries.md](existing-UL-APIs-and-libraries.md).

To see a table of all Universal Library functions and their corresponding JMCCUL methods, go to [implementation-status-of-UL-functions](implementation-status-of-UL-functions.md).

To see a list of all Universal Library configuration items and their corresponding JMCCUL implementation, go to [implementation-status-of-config-items](implementation-status-of-config-items.md).

## Getting started

Follow the steps in [first-time-setup.md](first-time-setup.md) each time a DAQ device is connected to a computer which it has not been previously connected to.

## Usage

For ready-to-use examples, see the [`xyz.froud.jmccul_examples` package](src/main/java/xyz/froud/jmccul_examples).

### Open a DAQ device

To quickly open a DAQ device:

```java
DaqDevice myDevice = DaqDevice.findFirst().get();
```

To discover all connected DAQ devices then open the first one:

```java
DaqDeviceDescriptor[] allDescriptors = DaqDeviceDescriptor.find();
DaqDevice myDevice = new DaqDevice(allDescriptors[0]);
```

Call `myDevice.close()` when finished.

Several more static methods are available in DaqDevice.java and DaqDeviceDescriptor.java to find and filter devices.

#### Difference between `DaqDevice` and `DaqDeviceDescriptor`

The Java class `DaqDeviceDescriptor` is a wrapper around the [Universal Library C struct of the same name](https://files.digilent.com/manuals/Mcculw_WebHelp/hh_goto.htm?ULStart.htm#Function_Reference/Device-Discovery/DaqDeviceDescriptor-type.htm). The file DaqDeviceDescriptor.java was initially generated by JNAerator.

A `DaqDeviceDescriptor` represents a physical DAQ device which is connected to the computer and detected by Universal Library, but may not be opened by Universal Library yet.

The Java class `DaqDevice` represents a DAQ device which has been opened by Universal Library.

All DAQ device creation methods ultimately call the Universal Library function [`cbCreateDaqDevice()`](https://files.digilent.com/manuals/Mcculw_WebHelp/hh_goto.htm?ULStart.htm#Function_Reference/Device-Discovery/cbCreateDaqDevice.htm) from the `DaqDevice` constructor.


### Do stuff

| Category              | Example file                                                                                   | Important method(s)                                                           | Wrapper class                                                                                 |
|-----------------------|------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------|
| **Analog input**      | [AnalogInputExample.java](src/main/java/xyz/froud/jmccul_examples/AnalogInputExample.java)     | `myDevice.analog.input.read()`<br>`myDevice.analog.input.readVoltage()`       | [AnalogInputWrapper.java](src/main/java/xyz/froud/jmccul/analog/AnalogInputWrapper.java)      |
| **Analog output**     | [AnalogOutputExample.java](src/main/java/xyz/froud/jmccul_examples/AnalogOutputExample.java)   | `myDevice.analog.output.write()`<br>`myDevice.analog.output.writeVoltage()`   | [AnalogOutputWrapper.java](src/main/java/xyz/froud/jmccul/analog/AnalogOutputWrapper.java)    |
| **Digital input**     | [DigitalInputExample.java](src/main/java/xyz/froud/jmccul_examples/DigitalInputExample.java)   | `myDevice.digital.input.readPort()`<br>`myDevice.digital.input.readBit()`     | [DigitalInputWrapper.java](src/main/java/xyz/froud/jmccul/digital/DigitalInputWrapper.java)   |
| **Digital output**    | [DigitalOutputExample.java](src/main/java/xyz/froud/jmccul_examples/DigitalOutputExample.java) | `myDevice.digital.output.writePort()`<br>`myDevice.digital.output.writeBit()` | [DigitalOutputWrapper.java](src/main/java/xyz/froud/jmccul/digital/DigitalOutputWrapper.java) |
| **Temperature input** | [TemperatureExample.java](src/main/java/xyz/froud/jmccul_examples/TemperatureExample.java)     | `myDevice.temperature.read()`                                                 | [TemperatureWrapper.java](src/main/java/xyz/froud/jmccul/temperature/TemperatureWrapper.java) |


There is also partial implementation of [counter](src/main/java/xyz/froud/jmccul/counter) and
[expansion](src/main/java/xyz/froud/jmccul/ex).


## Known bugs / limitations / future work

* I don't know how to write the JNA bindings for some function.

* I don't have hardware which supports some functions.

* The counter functions look scary.

* The device discovery stuff will be confusing for others. Need to document the difference between DaqDeviceDescriptor and DaqDevice.
  * I wrote some utility methods to filter stuff. I think I should either write a bunch more utility functions, or remove all of them.

* Some class names are not great like Configuration.java. I'm not sure if everything should have a JMCCUL prefix.

* Validate arguments a lot. In Java, we can tell a lot (for example if a channel is in range) which we can validate before passing it to the native C thing.

* What's the deal with Port vs PortType??

* I have a list of stuff to ask MCC.

* Replace static block for enum valueMap with this line

    ```java
    = Arrays.stream(values()).collect(Collectors.toMap(
                    alarmType -> alarmType.VALUE,
                    Function.identity()
            ));
    ```